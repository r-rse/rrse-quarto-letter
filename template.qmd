---
author:
  - name: Anna Krystalli
    affiliation:
      - name: Dr Anna Krystalli
        department: R - RSE
        address: Dani
        city: Syros
        country: Greece
        postal-code: 84100
fromtelephone: +30 697 299 3354
fromemail: r.rse.eu@gmail.com
fromlogo: assets/r-rse-logo2.png
fromurl: r-rse.eu
address:
  - Director Doe & Co
  - 35 Anthony Road
  - Newport
  - Ipswich IP3 5RT
invoice: "00001"
subject: collaboration
opening: "Dear Sir or Madam,"
closing: "Yours Faithfully,"
cc:
  - Recipient 1
  - Recipient 2
encl:
  - Enclosure 1
  - Enclosure 2
ps: |
  PS: Lorem ipsum dolor sit amet, *consectetur* adipiscing elit.
format: rrse-letter-pdf
---
```{r, echo = FALSE, message=FALSE}
library(huxtable)
library(dplyr)

currency <- "pound"
tax_rate <- 0

format_currency <- function(x, 
                            currency = c("dollar",
                                         "euro",
                                         "pound")) { 
    currency <- match.arg(currency)
    currency_symbol <- switch (
        currency,
        dollar = "US$",
        euro = "€",
        pound = "£"
    )
    paste(currency_symbol,
          format(x, big.mark = ",", decimal.mark = ".",
                 trim = TRUE, scientific = FALSE, nsmall = 2,
                 digits=1L)
          ) 
}
```


```{r, echo = FALSE, message=FALSE}
item_table <- tibble::tribble(
    ~`Item ID`, ~`Item Description`, ~Cost, 
    "D1",   "Descr 1", 1500, 
    "D2",   "Descr 2", 1500) 


subtotal <- item_table |>
    pull(Cost) |>
    sum()
tax <- tax_rate * subtotal
total <- subtotal + tax

invoice_table <- tibble::tribble(
    ~`Invoice No.`, ~`Invoice Date`, ~`Amount Due`, 
    "0001",   Sys.Date(), format_currency(total, currency)) 

```

```{r, echo = FALSE, message=FALSE}
invoice_table |>
    as_hux() |>
    style_headers(bold = TRUE, text_color = "#4BA2A6") |>
    set_position("right") 
```


```{r, echo = FALSE, message=FALSE}
item_table |>
    mutate(Cost = format_currency(Cost, "pound")) |>
    as_hux() |>
    set_background_color(odds, everywhere, "#DEECEE") |>
    set_background_color(1, everywhere, "#4BA2A6") |>
    style_headers(bold = TRUE, text_color = "white") |>
    set_width(1) |>
    set_align(everywhere, 3, "right") |>
    set_align(1, 3, "center") |>
    set_col_width(c(.2, .6, .2)) 
    
```


```{r, echo=FALSE, message=FALSE}
totals <- tibble::tibble(
    desc = c("Subtotal", 
             paste("VAT @", scales::percent(tax_rate)), 
             "Total Due"),
    value = c(format_currency(subtotal, currency),
              format_currency(tax, currency),
              format_currency(total, currency))) |>
    as_hux() |>
    style_headers(bold = TRUE, text_color = "white") |>
    set_bold(everywhere, 1) |>
    set_width(0.4) |>
    set_align(everywhere, 2, "left") |>
    set_col_width(c(.5, .5)) |>
    set_position("right") |>
    set_top_border(4, everywhere, brdr(0.8, "solid", "#4BA2A6")) |>
    set_align(-1, 2, ".") 

if (tax_rate == 0) {
    totals <- add_footnote(totals, "* Although VAT is 0%, you will likely be liable to paying VAT. Check with your finance department", 
                 border = 0.4)
}

totals

```

